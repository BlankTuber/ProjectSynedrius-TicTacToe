<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Tic-Tac-Toe</title>
        <link rel="stylesheet" href="styles/style.css">
    </head>
    <body>
        <h1>Tic-Tac-Toe Game</h1>
        <div id="winnerDiv">
            <h2 id="winnerDisplay"></h2>
        </div>
        <div id="game">
            <table border="1" id="tttable">
                <tr>
                    <td class="tttcell" data-row="0" data-col="0" data-owner=""></td>
                    <td class="tttcell" data-row="0" data-col="1" data-owner=""></td>
                    <td class="tttcell" data-row="0" data-col="2" data-owner=""></td>
                </tr>
                <tr>
                    <td class="tttcell" data-row="1" data-col="0" data-owner=""></td>
                    <td class="tttcell" data-row="1" data-col="1" data-owner=""></td>
                    <td class="tttcell" data-row="1" data-col="2" data-owner=""></td>
                </tr>
                <tr>
                    <td class="tttcell" data-row="2" data-col="0" data-owner=""></td>
                    <td class="tttcell" data-row="2" data-col="1" data-owner=""></td>
                    <td class="tttcell" data-row="2" data-col="2" data-owner=""></td>
                </tr>
            </table>
        </div>
        <script src="/socket.io/socket.io.js"></script>
        <script>
            const socket = io();

            socket.on('connect', () => {
                console.log('Connected to server');
            });

            const winConditions = [
                [[0, 0], [0, 1], [0, 2]],
                [[1, 0], [1, 1], [1, 2]],
                [[2, 0], [2, 1], [2, 2]],
                [[0, 0], [1, 0], [2, 0]],
                [[0, 1], [1, 1], [2, 1]],
                [[0, 2], [1, 2], [2, 2]],
                [[0, 0], [1, 1], [2, 2]],
                [[0, 2], [1, 1], [2, 0]]
            ];

            let game = {
                currentPlayer: 'X',
                who: 0,
                isGameOver: false,
                plays: {}
            }

            document.querySelectorAll('.tttcell').forEach(cell => {
                cell.addEventListener('click', (event) => {
                    select(event.target);
                });
            });

            function select(cell) {
                const row = cell.getAttribute('data-row');
                const col = cell.getAttribute('data-col');
                const pos = `${row}-${col}`;

                if (game.plays[pos] || game.isGameOver) {
                    return;
                } else {
                    game.plays[pos] = game.currentPlayer;
                }

                cell.classList.add('selected');
                cell.appendChild(document.createTextNode(game.currentPlayer));
                cell.setAttribute('data-owner', game.currentPlayer);
                checkWin(game.currentPlayer);
                togglePlayer();
                console.log(game);
            }

            function togglePlayer() {
                game.currentPlayer = game.currentPlayer === 'X' ? 'O' : 'X';
                game.who = 1 - game.who;
            }

            function checkWin(player) {
                for (const condition of winConditions) {
                    if (condition.every(([row, col]) => game.plays[`${row}-${col}`] === player)) {
                        game.isGameOver = true;
                        showWinner(`${player}`);
                        return;
                    }
                }

                // Check for a tie (if all cells are filled and no winner)
                if (Object.keys(game.plays).length === 9 && !game.isGameOver) {
                    game.isGameOver = true;
                    showWinner("none");
                }
            }
            
            function showWinner(winner) {
                const winnerMessage = winner === 'none'? 'It\'s a tie!' : `Player ${winner} wins!`;
                document.getElementById("winnerDisplay").innerText = winnerMessage;
                document.getElementById("winnerDiv").style.display = "flex";
            }


            // Additional client-side socket handlers can be added here
        </script>
    </body>
</html>